<?xml version="1.0" encoding="UTF-8"?>
<report xmlns="http://www.jenitennison.com/xslt/xspec"
        xspec="file:/C:/Users/minigrrl/Dropbox/12_SourceControl/GitHub/Lantana/FHIRTransforms/transforms/cda2fhir-r4/xspec-unit-tests/cda2fhir-MedicationAdministration.xspec"
        stylesheet="file:/C:/Users/minigrrl/Dropbox/12_SourceControl/GitHub/Lantana/FHIRTransforms/transforms/cda2fhir-r4/cda2fhir-MedicationAdministration.xslt"
        date="2022-01-04T15:29:40.35633+10:00">
   <scenario id="scenario1"
             xspec="file:/C:/Users/minigrrl/Dropbox/12_SourceControl/GitHub/Lantana/FHIRTransforms/transforms/cda2fhir-r4/xspec-unit-tests/cda2fhir-MedicationAdministration.xspec">
      <label>Scenario for testing template with match 'cda:substanceAdministration[cda:templateId/@root = '2.16.840.1.113883.10.20.22.4.16'][@moodCode = 'EVN'][ancestor::*/cda:templateId[@root = '2.16.840.1.113883.10.20.22.2.38']]' and mode 'bundle-entry'</label>
      <input-wrap xmlns="">
         <x:context xmlns:cda="urn:hl7-org:v3"
                    xmlns:fhir="http://hl7.org/fhir"
                    xmlns:lcg="http://www.lantanagroup.com"
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                    xmlns:x="http://www.jenitennison.com/xslt/xspec"
                    href="file:/C:/Users/minigrrl/Dropbox/12_SourceControl/GitHub/Lantana/FHIRTransforms/samples/cda/eICR-R3/eICR-CDA-001_R3.xml"
                    select="//cda:substanceAdministration[cda:templateId/@root = '2.16.840.1.113883.10.20.22.4.16'][@moodCode = 'EVN'][ancestor::*/cda:templateId[@root = '2.16.840.1.113883.10.20.22.2.38']]"
                    mode="bundle-entry"/>
      </input-wrap>
      <result select="/element()">
         <content-wrap xmlns="">
            <entry xmlns="http://hl7.org/fhir">
               <fullUrl value="urn:uuid:"/>
               <resource>
                  <MedicationAdministration><!--No profiles found for any of the following templates: urn:hl7ii:2.16.840.1.113883.10.20.22.4.16urn:hl7ii:2.16.840.1.113883.10.20.22.4.16:2014-06-09-->
                     <ws xmlns="http://www.jenitennison.com/xslt/xspec">
                                    
                                    
                                    
                                    
                                    
                                    
                                        
                                    
                                    
                                </ws>
                     <identifier>
                        <system value="urn:ietf:rfc:3986"/>
                        <value value="urn:uuid:6c844c75-aa34-411c-b7bd-5e4a9f206e29"/>
                     </identifier>
                     <status value="completed"/>
                     <medicationCodeableConcept>
                        <coding>
                           <system value="http://www.nlm.nih.gov/research/umls/rxnorm"/>
                           <code value="248656"/>
                           <display value="Azithromycin 500 MG Oral Tablet"/>
                        </coding>
                     </medicationCodeableConcept>
                     <subject>
                        <reference value="urn:uuid:"/>
                     </subject>
                     <effectiveDateTime value="2020-11-07T11:15:00.000-07:00"/>
                     <performer>
                        <actor>
                           <reference value="urn:uuid:"/>
                        </actor>
                     </performer>
                     <dosage>
                        <route>
                           <coding>
                              <system value="http://ncimeta.nci.nih.gov"/>
                              <code value="C38288"/>
                              <display value="ORAL"/>
                           </coding>
                        </route>
                        <dose>
                           <value value="1"/>
                           <unit value="g"/>
                        </dose>
                     </dosage>
                  </MedicationAdministration>
               </resource>
            </entry>
         </content-wrap>
      </result>
      <test id="scenario1-expect1" successful="true">
         <label>There should be an entry.resource.MedicationAdministration</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:entry/fhir:resource/fhir:MedicationAdministration)=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
   </scenario>
   <scenario id="scenario2"
             xspec="file:/C:/Users/minigrrl/Dropbox/12_SourceControl/GitHub/Lantana/FHIRTransforms/transforms/cda2fhir-r4/xspec-unit-tests/cda2fhir-MedicationAdministration.xspec">
      <label>Scenario for testing template with match 'cda:substanceAdministration[cda:templateId/@root = '2.16.840.1.113883.10.20.22.4.16'][@moodCode = 'EVN'][ancestor::*/cda:templateId[@root = '2.16.840.1.113883.10.20.22.2.38']]</label>
      <input-wrap xmlns="">
         <x:context xmlns:cda="urn:hl7-org:v3"
                    xmlns:fhir="http://hl7.org/fhir"
                    xmlns:lcg="http://www.lantanagroup.com"
                    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                    xmlns:x="http://www.jenitennison.com/xslt/xspec"
                    href="file:/C:/Users/minigrrl/Dropbox/12_SourceControl/GitHub/Lantana/FHIRTransforms/samples/cda/eICR-R3/eICR-CDA-001_R3.xml"
                    select="//cda:substanceAdministration[cda:templateId/@root = '2.16.840.1.113883.10.20.22.4.16'][@moodCode = 'EVN'][ancestor::*/cda:templateId[@root = '2.16.840.1.113883.10.20.22.2.38']]"/>
      </input-wrap>
      <result select="/element()">
         <content-wrap xmlns="">
            <MedicationAdministration xmlns="http://hl7.org/fhir"><!--No profiles found for any of the following templates: urn:hl7ii:2.16.840.1.113883.10.20.22.4.16urn:hl7ii:2.16.840.1.113883.10.20.22.4.16:2014-06-09-->
               <ws xmlns="http://www.jenitennison.com/xslt/xspec">
                                    
                                    
                                    
                                    
                                    
                                    
                                        
                                    
                                    
                                </ws>
               <identifier>
                  <system value="urn:ietf:rfc:3986"/>
                  <value value="urn:uuid:6c844c75-aa34-411c-b7bd-5e4a9f206e29"/>
               </identifier>
               <status value="completed"/>
               <medicationCodeableConcept>
                  <coding>
                     <system value="http://www.nlm.nih.gov/research/umls/rxnorm"/>
                     <code value="248656"/>
                     <display value="Azithromycin 500 MG Oral Tablet"/>
                  </coding>
               </medicationCodeableConcept>
               <subject>
                  <reference value="urn:uuid:"/>
               </subject>
               <effectiveDateTime value="2020-11-07T11:15:00.000-07:00"/>
               <performer>
                  <actor>
                     <reference value="urn:uuid:"/>
                  </actor>
               </performer>
               <dosage>
                  <route>
                     <coding>
                        <system value="http://ncimeta.nci.nih.gov"/>
                        <code value="C38288"/>
                        <display value="ORAL"/>
                     </coding>
                  </route>
                  <dose>
                     <value value="1"/>
                     <unit value="g"/>
                  </dose>
               </dosage>
            </MedicationAdministration>
         </content-wrap>
      </result>
      <test id="scenario2-expect1" successful="true">
         <label>There should be a MedicationAdministration</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration)=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect2" successful="true">
         <label>There should be a status='completed'</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:status[@value='completed'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect3" successful="true">
         <label>There should be a MedicationAdministration.medicationCodeableConcept.coding.system.value=http://www.nlm.nih.gov/research/umls/rxnorm</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:medicationCodeableConcept/fhir:coding/fhir:system[@value='http://www.nlm.nih.gov/research/umls/rxnorm'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect4" successful="true">
         <label>There should be a MedicationAdministration.medicationCodeableConcept.coding.code.value=248656</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:medicationCodeableConcept/fhir:coding/fhir:code[@value='248656'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect5" successful="true">
         <label>There should be a MedicationAdministration.medicationCodeableConcept.coding.display.value=Azithromycin 500 MG Oral Tablet</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:medicationCodeableConcept/fhir:coding/fhir:display[@value='Azithromycin 500 MG Oral Tablet'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect6" successful="true">
         <label>There should be an MedicationAdministration.subject.reference.value=urn:uuid:</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:subject/fhir:reference[@value='urn:uuid:'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect7" successful="true">
         <label>There should be a effectiveDateTime.value where the first 19 chars are: '2020-11-07T11:15:00' (ingoring TZ)</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:effectiveDateTime[substring(@value, 1,19) ='2020-11-07T11:15:00'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect8" successful="true">
         <label>There should be an MedicationAdministration.performer.actor.reference.value=urn:uuid:</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:performer/fhir:actor/fhir:reference[@value='urn:uuid:'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect9" successful="true">
         <label>There should be a dosage.route.coding.system.value=http://ncimeta.nci.nih.gov</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:dosage/fhir:route/fhir:coding/fhir:system[@value='http://ncimeta.nci.nih.gov'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect10" successful="true">
         <label>There should be a dosage.route.coding.code.value=C38288</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:dosage/fhir:route/fhir:coding/fhir:code[@value='C38288'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect11" successful="true">
         <label>There should be a dosage.route.coding.display.value=ORAL</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:dosage/fhir:route/fhir:coding/fhir:display[@value='ORAL'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
      <test id="scenario2-expect12" successful="true">
         <label>There should be a dose with value = '1' and unit = 'g'</label>
         <expect-test-wrap xmlns="">
            <x:expect xmlns:cda="urn:hl7-org:v3"
                      xmlns:fhir="http://hl7.org/fhir"
                      xmlns:lcg="http://www.lantanagroup.com"
                      xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                      xmlns:x="http://www.jenitennison.com/xslt/xspec"
                      test="count(fhir:MedicationAdministration/fhir:dosage/fhir:dose[fhir:value/@value='1'][fhir:unit/@value='g'])=1"/>
         </expect-test-wrap>
         <expect select="()"/>
      </test>
   </scenario>
</report>
