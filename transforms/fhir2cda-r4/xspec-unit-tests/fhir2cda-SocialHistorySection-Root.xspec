<?xml version="1.0" encoding="UTF-8"?>
<x:description xmlns:x="http://www.jenitennison.com/xslt/xspec" 
    xmlns:cda="urn:hl7-org:v3" 
    xmlns:fhir="http://hl7.org/fhir"
    xmlns:lcg="http://www.lantanagroup.com" stylesheet="../fhir2cda.xslt">
    
    <!--Scenario for testing template with match 'fhir:SocialHistory'  -->
    <x:scenario label="Scenario for testing fhir:section:SocialHistory -> cda:section with xspec-test-files/XSPEC_eICR-FHIR-002_R2_1.xml">
        <x:context href="../../../samples/fhir/xspec-test-files/XSPEC_eICR-FHIR-002_R2_1.xml" 
            select="/fhir:Bundle/fhir:entry/fhir:resource/fhir:Composition"/>
        
        <x:expect label="1-1 [C-CDA 1.1] SocialHistorySection Section @templateId=2.16.840.1.113883.10.20.22.2.17 CONF#1198-7936, 1198-10449, 1198-32494 " 
            test="//cda:component/cda:section/cda:templateId/@root='2.16.840.1.113883.10.20.22.2.17'"/>
        
        <x:expect label="1-2 [C-CDA 2.1] SocialHistorySection Section (V3) @templateId=2.16.840.1.113883.10.20.22.2.17:2015-08-01 CONF#1198-7936, 1198-10449, 1198-32494 " 
            test="//cda:component/cda:section/cda:templateId/@root='2.16.840.1.113883.10.20.22.2.17' and //cda:component/cda:section/cda:templateId/@extension='2015-08-01'"/>
        
        <x:expect label="1-3 [ODH R2] Occupational Data for Health Templates Requirement Section (V2) @templateId=2.16.840.1.113883.10.20.22.2.17:2020-09-01 CONF#1198-7936, 1198-10449, 1198-32494 " 
            test="//cda:component/cda:section/cda:templateId/@root='2.16.840.1.113883.10.20.22.2.17' and //cda:component/cda:section/cda:templateId/@extension='2015-08-01'"/>
           
        <x:expect label="2 Section @code=29762-2 @codeSystem=2.16.840.1.113883.6.1 CONF#1198-14819, 1198-14820, 1198-30814 " 
            test="//cda:component/cda:section/cda:code/@code='29762-2' and //cda:component/cda:section/cda:code/@codeSystem='2.16.840.1.113883.6.1'"/>
        
        <x:expect label="3 Section title=Social History Section  CONF#1198-7938" 
            test="//cda:component/cda:section/cda:title = 'Social History Section'" />
             
        <x:expect label="4 Section text CONF#1198-7939" 
            test="exists(//cda:component/cda:section/cda:text)" />
      
        <x:expect label="5 Section entry Observation for Home Enviroment Observation @classCode=OBS @moodCode=EVN @templateId=2.16.840.1.113883.10.20.22.4.109 CONF#1098-28825, 1098-27890, 1098-27891,1098-27893 " 
            test="//cda:component/cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:component/cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.22.4.109'" />
            
        <x:expect label="6 Characteristics of Home Environment Observation Id present CONF#1098-27894" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="7 Characteristics of Home Environment Observation code @code=75274 @codeSystem=2.16.840.1.113883.6.1 CONF#1098-31352, 1098-31353, 1098-31354 " 
            test="//cda:section/cda:entry/cda:observation/cda:code/@code='75274-1' and //cda:section/cda:entry/cda:observation/cda:code/@codeSystem='2.16.840.1.113883.6.1'"/> 
        
        <x:expect label="8 Characteristics of Home Environment Observation statusCode @code=completed CONF#1098-27901, 1098-27902" 
            test="count(//cda:section/cda:entry/cda:observation/cda:statusCode/@code='completed')=1"/>
        
        <!-- the value is dynamic value, we just check structure here instead of value -->
        <x:expect label="9 Characteristics of Home Environment Observation value present CONF#1098-28823" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
        
        <!-- Travel history -->
        <x:expect label="10 Travel history is ACT EVN CONF#4527-248, 4527-249" 
            test="//cda:section/cda:entry/cda:act/@classCode='ACT' and //cda:section/cda:entry/cda:act/@moodCode='EVN'"/>
        
        <x:expect label="11 Travel history ACT templateId=2.16.840.1.113883.10.20.15.2.3.1 extension=2022-05-01 CONF#4527-240, 4527-244, 4527-245" 
            test="//cda:section/cda:entry/cda:act/cda:templateId/@root='2.16.840.1.113883.10.20.15.2.3.1' and //cda:section/cda:entry/cda:act/cda:templateId/@extension='2022-05-01'"/>
        
        <x:expect label="12 Travel history ACT id present CONF#4527-250" 
            test="exists(//cda:section/cda:entry/cda:act/cda:id)"/>
        
        <x:expect label="13 Travel history ACT code=420008001 codeSystem=2.16.840.1.113883.6.96 CONF#4527-251, 4527-253, 4527-254" 
            test="//cda:section/cda:entry/cda:act/cda:code/@code='420008001' and //cda:section/cda:entry/cda:act/cda:code/@codeSystem='2.16.840.1.113883.6.96'"/>
        
        <x:expect label="14 Travel history ACT text [0..1] CONF#4527-269" 
            test="exists(//cda:section/cda:entry/cda:act/cda:text)"/>
        
        <x:expect label="15 Travel history ACT effectiveTime present CONF#4527-295" 
            test="exists(//cda:section/cda:entry/cda:act/cda:effectiveTime)"/>
        
        <x:expect label="16 Travel history ACT participant typeCode=LOC CONF#4527-257" 
            test="//cda:section/cda:entry/cda:act/cda:participant/@typeCode='LOC'"/>
        
        <x:expect label="17 Travel history ACT participant participantRole classCode=TERR CONF#4527-257" 
            test="//cda:section/cda:entry/cda:act/cda:participant/cda:participantRole/@classCode='TERR'"/>
        
        
        <x:expect label="18 Travel history ACT participant participantRole code present CONF#4527-263" 
            test="exists(//cda:section/cda:entry/cda:act/cda:participant/cda:participantRole/cda:code)"/>
        
        <x:expect label="19 Travel history ACT entryRelationship typeCode=COMP CONF#4527-958" 
            test="//cda:section/cda:entry/cda:act/cda:entryRelationship/@typeCode='COMP'"/>
        
        <x:expect label="20 Travel history ACT entryRelationship observation OBS, EVN CONF#4527-965, 4527-966" 
            test="//cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/@classCode='OBS'
            and //cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/@moodCode='EVN'"/>
        
        <x:expect label="21 Travel history ACT entryRelationship Purpose of Travel Observation templateId 2.16.840.1.113883.10.20.15.2.3.51:2022-05-01 CONF#4527-959, 4527-961, 4527-962" 
            test="//cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.15.2.3.51'
            and //cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/cda:templateId/@extension='2022-05-01'"/>
        
        <x:expect label="22 Travel history ACT entryRelationship Purpose of Travel Observation id present CONF#4527-967" 
            test="exists(//cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/cda:id)"/>
        
        <x:expect label="23 Travel history ACT entryRelationship Purpose of Travel Observation code present CONF#4527-963" 
            test="exists(//cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/cda:code)"/>
        
        <x:expect label="24 Travel history ACT entryRelationship Purpose of Travel Observation statusCode present CONF#4527-970" 
            test="exists(//cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/cda:statusCode)"/>
        
        <!-- ??? IG does not effectiveTime -->
        <x:expect label="25 ???Travel history ACT entryRelationship Purpose of Travel Observation effectiveTime present CONF#" 
            test="exists(//cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="26 Travel history ACT entryRelationship Purpose of Travel Observation value present CONF#4527-985" 
            test="exists(//cda:section/cda:entry/cda:act/cda:entryRelationship/cda:observation/cda:value)"/>
        
        <x:expect label="27 Section entry Observation for Exposure/Contact Information Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.15.2.3.52:2021-01-01 CONF#4428-981, 4428-982, 4428-975, 4428-978 " 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.15.2.3.52'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2021-01-01'" />
        
        <x:expect label="28 Exposure/Contact Information Observation id present CONF#4428-983" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="29 Exposure/Contact Information Observation code present CONF#4428-976" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:code)"/>
        
        <x:expect label="30 Exposure/Contact Information Observation statusCode present CONF#4428-986" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:statusCode)"/>
        
        <x:expect label="31 Exposure/Contact Information Observation effectiveTime present CONF#4428-985" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="32 Exposure/Contact Information Observation value present CONF#4428-999" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
        
        <x:expect label="33 Section entry Observation Country of Residence Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.15.2.3.53:2021-01-01 CONF#4482-1070, 4482-1071, 4482-1064, 4482-1066, 4482-1067 " 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.15.2.3.53'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2021-01-01'" />
        
        <x:expect label="34 Country of Residence Observation id present CONF#4482-1072" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="35 Country of Residence Observation code @code=77983-5 @system=2.16.840.1.113883.6.1 CONF#4482-1065, 4482-1068, 4482-1069" 
            test="//cda:section/cda:entry/cda:observation/cda:code/@code='77983-5'
            and //cda:section/cda:entry/cda:observation/cda:code/@codeSystem='2.16.840.1.113883.6.1'"/>
        
        <x:expect label="36 Country of Residence Observation statusCode present CONF#4482-1074" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:statusCode)"/>
        
        <x:expect label="37 ???Country of Residence Observation effectiveTime present CONF#" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="38 Country of Residence Observation value present CONF#4482-1073" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
        
        <x:expect label="39 Section entry Observation Country of Nationality Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.15.2.3.54:2021-01-01 CONF#4482-1081, 4482-1082, 4482-1075, 4482-1077, 4482-1078 " 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.15.2.3.54'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2021-01-01'" />
        
        <x:expect label="40 Country of Nationality Observation id present CONF#4482-1083" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="41 Country of Nationality Observation code @code=186034007 @system=2.16.840.1.113883.6.96 CONF#4482-1076, 4482-1079, 4482-1080" 
            test="//cda:section/cda:entry/cda:observation/cda:code/@code='186034007'
            and //cda:section/cda:entry/cda:observation/cda:code/@codeSystem='2.16.840.1.113883.6.96'"/>
                
        <x:expect label="42 Country of Nationality Observation statusCode present CONF#4482-1085" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:statusCode)"/>
        
        <x:expect label="43 Country of Nationality Observation effectiveTime present CONF#4428-985" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="44 Country of Nationality Observation value present CONF#4482-1084" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
        
        <x:expect label="45 Section entry Observation Birth Sex Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.22.4.200:2016-06-01 CONF#3250-18230, 3250-18231, 3250-18232, 3250-18233, 3250-32949" 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.22.4.200'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2016-06-01'" />
        
        <x:expect label="46 Section entry Observation Birth Sex Observation code @code=76689-9 @system=2.16.840.1.113883.6.1 CONF#3250-18234, 3250-18235, 3250-21163" 
            test="//cda:section/cda:entry/cda:observation/cda:code/@code='76689-9'
            and //cda:section/cda:entry/cda:observation/cda:code/@codeSystem='2.16.840.1.113883.6.1'"/>
        
        <x:expect label="47 Section entry Observation Birth Sex Observation statusCode @code=completed CONF#3250-18124, 3250-18125" 
            test="//cda:section/cda:entry/cda:observation/cda:statusCode/@code='completed'"/>
        
        <x:expect label="48 ??? Section entry Observation Birth Sex Observation effectiveTime present CONF#" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="49 Section entry Observation Birth Sex Observation value present CONF#3250-32947" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
        
        <x:expect label="50 Section entry Observation Gender Identity Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.34.3.45:2022-06-01 CONF#4515-1230, 4515-1231, 4515-1221, 4515-1225, 4515-1226" 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.34.3.45'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2022-06-01'" />
        
        <x:expect label="51 Section entry Observation Gender Identity Observation id present CONF#4515-33033" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="52 Section entry Observation Gender Identity Observation code @code=76691-5 @system=2.16.840.1.113883.6.1 CONF#4515-1222, 4515-1227, 4515-1228," 
            test="//cda:section/cda:entry/cda:observation/cda:code/@code='76691-5'
            and //cda:section/cda:entry/cda:observation/cda:code/@codeSystem='2.16.840.1.113883.6.1'"/>
        
        <x:expect label="53 Section entry Observation Gender Identity Observation statusCode @code=completed CONF#4515-33031, 4515-33032" 
            test="//cda:section/cda:entry/cda:observation/cda:statusCode/@code='completed'"/>
        
        <x:expect label="54 Section entry Observation Gender Identity Observation effectiveTime present CONF#4515-33033" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="55 Section entry Observation Gender Identity Observation value present CONF#4515-1223" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
        
        <x:expect label="56 Section entry Observation Tribal Affiliation Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.15.2.3.48:2021-01-01 CONF#4482-915, 4482-916, 4482-911, 4482-912, 4482-913" 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.15.2.3.48'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2021-01-01'" />
        
        <x:expect label="57 Section entry Observation Tribal Affiliation Observation id present CONF#4482-917" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="58 Section entry Observation Tribal Affiliation Observation code present CONF#4482-914," 
            test="exists(//cda:section/cda:entry/cda:observation/cda:code)"/>
        
        <x:expect label="59 Section entry Observation Tribal Affiliation Observation statusCode present CONF#4482-920" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:statusCode)"/>
        
        <x:expect label="60 Section entry Observation Tribal Affiliation Observation effectiveTime present CONF#4482-919" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="61 Section entry Observation Tribal Affiliation Observation value present CONF#4482-918" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
        
        <x:expect label="62 Section entry Observation Disability Status  Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.15.2.3.47:2021-01-01 CONF#4482-903, 4482-904, 4482-899, 4482-900, 4482-901" 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.15.2.3.47'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2021-01-01'" />
        
        <x:expect label="63 Section entry Observation Disability Status  Observation id present CONF#4482-905" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="64 Section entry Observation Disability Status  Observation code present CONF#4482-902," 
            test="exists(//cda:section/cda:entry/cda:observation/cda:code)"/>
        
        <x:expect label="65 Section entry Observation Disability Status  Observation statusCode present CONF#4482-908" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:statusCode)"/>
        
        <x:expect label="66 Section entry Observation Disability Status  Observation effectiveTime present CONF#4482-907" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="67 Section entry Observation Disability Status  Observation value present CONF#4482-906" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
     
        <x:expect label="68 Section entry Observation History of Employment Status  Observation @classCode=OBS @moodCode=EVN 
            @templateId=2.16.840.1.113883.10.20.22.4.212:2017-11-30 CONF#3349-192, 3349-193, 3349-10, 3349-13, 3349-14" 
            test="//cda:section/cda:entry/cda:observation/@classCode='OBS' 
            and //cda:section/cda:entry/cda:observation/@moodCode='EVN'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@root='2.16.840.1.113883.10.20.22.4.212'
            and //cda:section/cda:entry/cda:observation/cda:templateId/@extension='2017-11-30'" />
        
        <x:expect label="69 Section entry Observation History of Employment Status  Observation id present CONF#3349-15" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:id)"/>
        
        <x:expect label="70 Section entry Observation History of Employment Status  Observation code @code=74165-2, @codeSystem=2.16.840.1.113883.6.1 CONF#3349-11, 3349-16, 3349-17," 
            test="//cda:section/cda:entry/cda:observation/cda:code/@code='74165-2'
            and //cda:section/cda:entry/cda:observation/cda:code/@codeSystem='2.16.840.1.113883.6.1'"/>
        
        <x:expect label="71 Section entry Observation History of Employment Status  Observation statusCode present CONF#3349-18" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:statusCode)"/>
        
        <x:expect label="72 Section entry Observation History of Employment Status Observation effectiveTime present CONF#3349-12" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:effectiveTime)"/>
        
        <x:expect label="73 Section entry Observation History of Employment Status  Observation value present CONF#3349-21" 
            test="exists(//cda:section/cda:entry/cda:observation/cda:value)"/>
      
    </x:scenario>
    
        
    
    
    
</x:description>
